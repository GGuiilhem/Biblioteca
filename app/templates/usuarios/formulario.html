{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">{% if usuario_id %}Editar Usuário{% else %}Novo Usuário{% endif %}</h2>
                </div>
                <div class="card-body">
                    <form id="formUsuario">
                        <input type="hidden" id="usuarioId" value="{{ usuario_id or '' }}">
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="nome" class="form-label">Nome Completo *</label>
                                <input type="text" class="form-control" id="nome" required>
                                <div class="invalid-feedback">Por favor, informe o nome completo.</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">E-mail *</label>
                                <input type="email" class="form-control" id="email" required>
                                <div class="invalid-feedback">Por favor, informe um e-mail válido.</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cpf" class="form-label">CPF *</label>
                                <input type="text" class="form-control cpf-mask" id="cpf" required>
                                <div class="invalid-feedback">Por favor, informe um CPF válido.</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="matricula" class="form-label">Matrícula *</label>
                                <input type="text" class="form-control" id="matricula" required>
                                <div class="invalid-feedback">Por favor, informe a matrícula.</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="tipo" class="form-label">Tipo de Usuário *</label>
                                <select class="form-select" id="tipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="aluno">Aluno</option>
                                    <option value="professor">Professor</option>
                                    <option value="funcionario">Funcionário</option>
                                    <option value="admin">Administrador</option>
                                </select>
                                <div class="invalid-feedback">Por favor, selecione o tipo de usuário.</div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="curso" class="form-label">Curso</label>
                                <input type="text" class="form-control" id="curso">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="telefone" class="form-label">Telefone</label>
                                <input type="tel" class="form-control phone-mask" id="telefone">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                                <input type="date" class="form-control" id="dataNascimento">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="endereco" class="form-label">Endereço</label>
                            <textarea class="form-control" id="endereco" rows="2"></textarea>
                        </div>
                        
                        <div class="form-check form-switch mb-4">
                            <input class="form-check-input" type="checkbox" id="ativo" checked>
                            <label class="form-check-label" for="ativo">Usuário ativo</label>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="/usuarios" class="btn btn-secondary me-md-2">
                                <i class="bi bi-arrow-left"></i> Voltar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Salvar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Máscaras para os campos -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Aplica máscaras nos campos
        $('.cpf-mask').mask('000.000.000-00');
        $('.phone-mask').mask('(00) 00000-0000');
        
        const form = document.getElementById('formUsuario');
        const usuarioId = document.getElementById('usuarioId').value;
        
        // Se estiver editando, carrega os dados do usuário
        if (usuarioId) {
            carregarUsuario(usuarioId);
        }
        
        // Validação do formulário
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!form.checkValidity()) {
                e.stopPropagation();
                form.classList.add('was-validated');
                return;
            }
            
            const usuarioData = {
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                cpf: document.getElementById('cpf').value.replace(/\D/g, ''),
                matricula: document.getElementById('matricula').value,
                tipo: document.getElementById('tipo').value,
                curso: document.getElementById('curso').value,
                telefone: document.getElementById('telefone').value,
                data_nascimento: document.getElementById('dataNascimento').value,
                endereco: document.getElementById('endereco').value,
                ativo: document.getElementById('ativo').checked
            };
            
            // Aqui vai a lógica para salvar o usuário
            console.log('Dados do usuário:', usuarioData);
            alert('Usuário salvo com sucesso!');
            window.location.href = '/usuarios';
        });
        
        function carregarUsuario(id) {
            // Aqui vai a lógica para carregar os dados do usuário
            console.log(`Carregando usuário com ID: ${id}`);
            // Simulando uma requisição
            setTimeout(() => {
                // Dados de exemplo - substituir pela chamada à API
                const usuarioExemplo = {
                    nome: 'João da Silva',
                    email: 'joao@exemplo.com',
                    cpf: '123.456.789-00',
                    matricula: '20230001',
                    tipo: 'aluno',
                    curso: 'Análise e Desenvolvimento de Sistemas',
                    telefone: '(11) 98765-4321',
                    data_nascimento: '1990-01-15',
                    endereco: 'Rua Exemplo, 123 - Centro',
                    ativo: true
                };
                
                document.getElementById('nome').value = usuarioExemplo.nome;
                document.getElementById('email').value = usuarioExemplo.email;
                document.getElementById('cpf').value = usuarioExemplo.cpf;
                document.getElementById('matricula').value = usuarioExemplo.matricula;
                document.getElementById('tipo').value = usuarioExemplo.tipo;
                document.getElementById('curso').value = usuarioExemplo.curso || '';
                document.getElementById('telefone').value = usuarioExemplo.telefone || '';
                document.getElementById('dataNascimento').value = usuarioExemplo.data_nascimento || '';
                document.getElementById('endereco').value = usuarioExemplo.endereco || '';
                document.getElementById('ativo').checked = usuarioExemplo.ativo !== false;
            }, 500);
        }
    });
</script>
{% endblock %}
